<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1">
  <title>UltraSpin</title>
  <link rel="stylesheet" href="./style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shadydom/1.0.14/shadydom.min.js"></script>
</head>
<body>
  <us-theme id="theme"></us-theme>
  <us-wheel id="wheel"></us-wheel>

  <!-- All of the Node.js APIs are available in this renderer process. -->
  <!--
  <h1>Hello World!</h1>
  We are using Node.js <script>document.write(process.versions.node);</script>,
  Chromium <script>document.write(process.versions.chrome);</script>,
  and Electron <script>document.write(process.versions.electron);</script>.
  -->
  <script src="./theme.js"></script>
  <script src="./wheel.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      let theme = document.getElementById('theme');
      let wheel = document.getElementById('wheel');

      let themes = [
        'MAME',
        'Atari 2600',
        'Nintendo Entertainment System',
        'Super Nintendo Entertainment System'
      ];

      wheel.addEventListener('render', function(evt) {
        evt.detail.element.innerHTML = '<img src="./wheel/' + themes[evt.detail.index % 4] + '.png">';
      });

      let changeThemeTimeout = null;
      let wheelActiveTimeout = null;

      wheel.addEventListener('change', function(evt) {
        clearTimeout(changeThemeTimeout);
        clearTimeout(wheelActiveTimeout);

        wheel.classList.add('active');

        changeThemeTimeout = setTimeout(function() {
          requestAnimationFrame(function() {
            let oldTheme = document.getElementById('theme');
            oldTheme.style.opacity = 0;
            oldTheme.remove();

            let theme = new USThemeElement();
            theme.id = 'theme';
            theme.name = themes[evt.detail.selectedIndex % 4];
            theme.style.opacity = 0;

            document.body.prepend(theme);

            requestAnimationFrame(function() {
              theme.style.opacity = 1;

              wheelActiveTimeout = setTimeout(function() {
                wheel.classList.remove('active');
              }, 1000);
            });
          });
        }, 500);
      });

      wheel.itemCount = 24;
    });
  </script>
</body>
</html>
